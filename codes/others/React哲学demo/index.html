<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.staticfile.org/react/16.4.0/umd/react.development.js"></script>
    <script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const productsList = [
            { category: "Sporting Goods", price: "$49.99", stocked: true, name: "Football" },
            { category: "Sporting Goods", price: "$9.99", stocked: true, name: "Baseball" },
            { category: "Sporting Goods", price: "$29.99", stocked: false, name: "Basketball" },
            { category: "Electronics", price: "$99.99", stocked: true, name: "iPod Touch" },
            { category: "Electronics", price: "$399.99", stocked: false, name: "iPhone 5" },
            { category: "Electronics", price: "$199.99", stocked: true, name: "Nexus 7" }
        ];


        class FilterableProductTable extends React.Component {//整体应用
            constructor(props) {
                super(props);
                this.state = {
                    list: productsList,
                    isFilter: false,
                    filterList: productsList.filter(val => val.stocked === true),
                    keyWord: '',
                }
                this.handleFilter = this.handleFilter.bind(this);
                this.handleTextInput = this.handleTextInput.bind(this);

            }

            handleFilter() {
                this.setState({
                    isFilter: !this.state.isFilter,
                });
            }

            handleTextInput(e) {
                this.setState({
                    keyWord: e.target.value,
                });
            }

            render() {
                const list = this.state.list;
                const filterList = list.filter(val => val.stocked === true);
                const searchWord = this.state.keyWord;
                let isMatch = false;
                let result;

                if (this.state.isFilter) {
                    result = filterList;
                }
                else {
                    result = list;
                }

                searchMatches();

                function searchMatches() {
                    if (searchWord.trim().length) {
                        for (let val of result) {
                            if (val.name.toLowerCase() === searchWord.trim().toLowerCase()) {
                                result = [val];
                                isMatch = true;
                            }
                        }
                        if (!isMatch) result = []
                    }

                }


                return (
                    <div className='table'>
                        <SearchBar handleClick={this.handleFilter} handleInput={this.handleTextInput} />
                        <ProductTable list={result} />
                    </div>
                );
            }
        }

        function SearchBar(props) {//头部，接受用户输入

            return (
                <div className='search-bar'>
                    <input type="text" placeholder='Search...' onChange={props.handleInput} /><br />
                    <input type="checkbox" onClick={props.handleClick} />Only show products in stock
                </div>
            );

        }

        function ProductTable(props) {//数据内容展示

            const list = props.list;
            const sports = list.filter(val => val.category === 'Sporting Goods')
                .map(item => (<ProductRow key={item.price} productName={item.name} productPrice={item.price} />));

            const electronics = list.filter(val => val.category === 'Electronics')
                .map(item => (<ProductRow key={item.price} productName={item.name} productPrice={item.price} />));

            return (
                <div>
                    <p className='title'>Name Price</p>
                    <ProductCategoryRow title='Sporting Goods' />
                    {sports}
                    <ProductCategoryRow title='Electronics' />
                    {electronics}
                </div>

            );

        }

        function ProductCategoryRow(props) {//产品标题

            return <p className='title'>{props.title}</p>
        }

        function ProductRow(props) {//每行展示的产品

            return (
                <div className='item'>
                    <span>{props.productName} {props.productPrice}</span>
                </div>
            );

        }



        ReactDOM.render(<FilterableProductTable />, document.getElementById('root'));

    </script>

</body>

</html>